(function(a){if(!a.utils){a.utils={}}a.utils.forEach=function(c,e,d){if(!c||c.length==0){return}if(d){e=utils.scope(d,e)}if(e){for(var b=0;b<c.length;b++){e(c[b],b,c)}}};a.utils.scope=function(b,c){if(!b||!c){return false}if(typeof c=="function"){return function(){c.apply(b,arguments)}}else{if(typeof c=="string"&&b[c]){return function(){b[c].apply(b,arguments)}}else{return false}}};a.utils.indexOf=function(h,g,e,d){var f=1,b=h.length||0,c=0;if(d){c=b-1;f=b=-1}if(e!=undefined){c=e}if((d&&c>b)||c<b){for(;c!=b;c+=f){if(h[c]==g){return c}}}return -1};a.utils.lastIndexOf=function(d,c,b){return utils.indexOf(d,c,b,true)}})(window);(function(window){window.deeplinker={_routes:{},_defaultCallback:null,_checkInterval:null,_window:null,_href:null,_defaultUpdateRate:100,_paused:false,init:function(routingWindow,updateRate){this._window=routingWindow;if("onhashchange" in this._window){console.log("onhashchange");this._window.addEventListener("hashchange",_checkHash,false)}else{this._checkInterval=setInterval(_checkHash,(updateRate||this._defaultUpdateRate))}},setDefaultCallback:function(callback){this._defaultCallback=callback},getRoute:function(href){if(typeof href=="string"){var safeHref=href.split("?",2)[0];var hash=safeHref.split("#!",2)[1];return hash?hash:false}else{return false}},getBasePath:function(){return this._window.location.protocol+"//"+this._window.location.hostname+this._window.location.pathname},route:function(path){var unfilteredPathItems=path.split("/");var pathItems=[];utils.forEach(unfilteredPathItems,function(item){if(item!=""){pathItems.push(item)}});var routeItem=_tree_run(this._routes,pathItems);if(routeItem){var routeCallback=routeItem.callback;var callbackArgs=_process_arguments(routeItem.args,routeItem.path,pathItems);var callable=_resolveCallback(routeCallback,callbackArgs);if(callable!=false){try{callable()}catch(e){console.error(e);return false}}else{return false}}else{return false}return true},addRoute:function(path,callback,args){var unfilteredPathItems=path.split("/");var pathItems=[];utils.forEach(unfilteredPathItems,function(item){if(item!=""){pathItems.push(item)}});var value={callback:callback,args:args};_tree_set(this._routes,pathItems,value)},removeRoute:function(path){var unfilteredPathItems=path.split("/");var pathItems=[];utils.forEach(unfilteredPathItems,function(item){if(item!=""){pathItems.push(item)}});_tree_set(this._routes,pathItems,null)},pause:function(){this._paused=true},resume:function(){this._paused=false},isPaused:function(){return this._paused}};function _tree_run(root,path){if(path.length>0){if(typeof root[path[0]]!="undefined"){return _tree_run(root[path[0]],path.slice(1))}else{if(typeof root["*"]!="undefined"){return _tree_run(root["*"],path.slice(1))}else{return false}}}else{return root}}function _tree_set(root,path,value,originalPath){if(typeof originalPath=="undefined"){originalPath=[]}if(path.length>1){var pathItem=path.shift();originalPath.push(pathItem);if(pathItem.indexOf(":")>-1){pathItem="*"}if(typeof root[pathItem]=="undefined"){root[pathItem]={}}_tree_set(root[pathItem],path,value,originalPath)}else{originalPath.push(path[0]);value.path=originalPath;if(path[0].indexOf(":")>-1){path[0]="*"}root[path[0]]=value}}function _process_arguments(declaredArgs,declaredPathItems,pathItems){var args=[];utils.forEach(declaredArgs,function(arg){if(typeof arg=="string"&&arg.indexOf(":")==0){var pathItemIdx=utils.indexOf(declaredPathItems,arg);if(pathItemIdx>-1){args.push(pathItems[pathItemIdx])}else{args.push(undefined)}}else{args.push(arg)}});return args}function _checkHash(){if(deeplinker._paused){return}var oldhref=deeplinker._href;var newhref=deeplinker._window.location.href;if(oldhref!=newhref){deeplinker._href=newhref;var route=deeplinker.getRoute(newhref);if(route){deeplinker.route(route)}else{if(deeplinker._defaultCallback){deeplinker._defaultCallback()}}}}function _resolveCallback(callback,args){if(typeof callback=="function"){return function(){callback.apply(window,args)}}else{if(typeof callback=="string"){return function(){eval(callback)}}else{if(typeof callback=="object"&&typeof callback.scope!="undefined"){if(typeof callback.method=="string"){return function(){callback.scope[callback.method].apply(callback.scope,args)}}else{if(typeof callback.method=="function"){return function(){callback.method.apply(callback.scope,args)}}else{return false}}}else{return false}}}}})(window);